     1	<!DOCTYPE html>
     2	<html lang="es">
     3	<head>
     4	    <meta charset="UTF-8">
     5	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     6	    <title>Panel Admin - Tu Dinero Claro</title>
     7	    <style>
     8	        * {
     9	            margin: 0;
    10	            padding: 0;
    11	            box-sizing: border-box;
    12	        }
    13	
    14	        body {
    15	            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    16	            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    17	            min-height: 100vh;
    18	            padding: 20px;
    19	        }
    20	
    21	        .container {
    22	            max-width: 1200px;
    23	            margin: 0 auto;
    24	        }
    25	
    26	        .header {
    27	            background: white;
    28	            padding: 30px;
    29	            border-radius: 12px;
    30	            margin-bottom: 20px;
    31	            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    32	        }
    33	
    34	        .header h1 {
    35	            color: #7c3aed;
    36	            margin-bottom: 10px;
    37	        }
    38	
    39	        .header p {
    40	            color: #666;
    41	        }
    42	
    43	        .stats-grid {
    44	            display: grid;
    45	            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    46	            gap: 20px;
    47	            margin-bottom: 20px;
    48	        }
    49	
    50	        .stat-card {
    51	            background: white;
    52	            padding: 25px;
    53	            border-radius: 12px;
    54	            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    55	        }
    56	
    57	        .stat-card h3 {
    58	            color: #666;
    59	            font-size: 14px;
    60	            font-weight: 500;
    61	            margin-bottom: 10px;
    62	        }
    63	
    64	        .stat-card .value {
    65	            font-size: 36px;
    66	            font-weight: bold;
    67	            color: #7c3aed;
    68	        }
    69	
    70	        .licenses-table {
    71	            background: white;
    72	            padding: 30px;
    73	            border-radius: 12px;
    74	            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    75	            overflow-x: auto;
    76	        }
    77	
    78	        .licenses-table h2 {
    79	            margin-bottom: 20px;
    80	            color: #333;
    81	        }
    82	
    83	        table {
    84	            width: 100%;
    85	            border-collapse: collapse;
    86	        }
    87	
    88	        thead {
    89	            background: #f8f9fa;
    90	        }
    91	
    92	        th {
    93	            padding: 12px;
    94	            text-align: left;
    95	            font-weight: 600;
    96	            color: #666;
    97	            border-bottom: 2px solid #e9ecef;
    98	        }
    99	
   100	        td {
   101	            padding: 12px;
   102	            border-bottom: 1px solid #e9ecef;
   103	        }
   104	
   105	        tr:hover {
   106	            background: #f8f9fa;
   107	        }
   108	
   109	        .license-key {
   110	            font-family: 'Courier New', monospace;
   111	            background: #f0f0f0;
   112	            padding: 4px 8px;
   113	            border-radius: 4px;
   114	            font-weight: bold;
   115	            color: #7c3aed;
   116	        }
   117	
   118	        .status {
   119	            display: inline-block;
   120	            padding: 4px 12px;
   121	            border-radius: 20px;
   122	            font-size: 12px;
   123	            font-weight: 600;
   124	        }
   125	
   126	        .status.sent {
   127	            background: #d4edda;
   128	            color: #155724;
   129	        }
   130	
   131	        .status.failed {
   132	            background: #f8d7da;
   133	            color: #721c24;
   134	        }
   135	
   136	        .loading {
   137	            text-align: center;
   138	            padding: 40px;
   139	            color: white;
   140	            font-size: 18px;
   141	        }
   142	
   143	        .error {
   144	            background: #f8d7da;
   145	            color: #721c24;
   146	            padding: 20px;
   147	            border-radius: 8px;
   148	            margin: 20px 0;
   149	        }
   150	
   151	        .refresh-btn {
   152	            background: #7c3aed;
   153	            color: white;
   154	            border: none;
   155	            padding: 12px 24px;
   156	            border-radius: 8px;
   157	            cursor: pointer;
   158	            font-weight: 600;
   159	            margin-bottom: 20px;
   160	            transition: background 0.3s;
   161	        }
   162	
   163	        .refresh-btn:hover {
   164	            background: #6d28d9;
   165	        }
   166	
   167	        .generate-section {
   168	            background: white;
   169	            padding: 30px;
   170	            border-radius: 12px;
   171	            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
   172	            margin-bottom: 20px;
   173	        }
   174	
   175	        .generate-section h2 {
   176	            margin-bottom: 20px;
   177	            color: #333;
   178	        }
   179	
   180	        .form-group {
   181	            margin-bottom: 15px;
   182	        }
   183	
   184	        .form-group label {
   185	            display: block;
   186	            margin-bottom: 5px;
   187	            font-weight: 600;
   188	            color: #666;
   189	        }
   190	
   191	        .form-group input {
   192	            width: 100%;
   193	            padding: 10px;
   194	            border: 1px solid #ddd;
   195	            border-radius: 6px;
   196	            font-size: 14px;
   197	        }
   198	
   199	        .generate-btn {
   200	            background: #10b981;
   201	            color: white;
   202	            border: none;
   203	            padding: 12px 24px;
   204	            border-radius: 8px;
   205	            cursor: pointer;
   206	            font-weight: 600;
   207	            transition: background 0.3s;
   208	        }
   209	
   210	        .generate-btn:hover {
   211	            background: #059669;
   212	        }
   213	
   214	        .success-message {
   215	            background: #d4edda;
   216	            color: #155724;
   217	            padding: 15px;
   218	            border-radius: 8px;
   219	            margin-top: 15px;
   220	        }
   221	    </style>
   222	</head>
   223	<body>
   224	    <div class="container">
   225	        <div class="header">
   226	            <h1>üîë Panel de Administraci√≥n - Tu Dinero Claro</h1>
   227	            <p>Gesti√≥n de licencias generadas autom√°ticamente</p>
   228	        </div>
   229	
   230	        <button class="refresh-btn" onclick="loadStats()">üîÑ Actualizar Datos</button>
   231	
   232	        <div class="stats-grid" id="statsGrid">
   233	            <div class="stat-card">
   234	                <h3>Total Licencias</h3>
   235	                <div class="value" id="totalLicenses">-</div>
   236	            </div>
   237	            <div class="stat-card">
   238	                <h3>Emails Enviados</h3>
   239	                <div class="value" id="emailsSent">-</div>
   240	            </div>
   241	            <div class="stat-card">
   242	                <h3>Emails Fallidos</h3>
   243	                <div class="value" id="emailsFailed">-</div>
   244	            </div>
   245	        </div>
   246	
   247	        <div class="generate-section">
   248	            <h2>‚ö° Generar Licencia Manual</h2>
   249	            <p style="color: #666; margin-bottom: 20px;">Usa esto solo si el webhook falla</p>
   250	            
   251	            <div class="form-group">
   252	                <label for="manualEmail">Email del Cliente</label>
   253	                <input type="email" id="manualEmail" placeholder="cliente@example.com" required>
   254	            </div>
   255	            
   256	            <div class="form-group">
   257	                <label for="manualName">Nombre del Cliente</label>
   258	                <input type="text" id="manualName" placeholder="Juan P√©rez">
   259	            </div>
   260	            
   261	            <button class="generate-btn" onclick="generateManual()">Generar y Enviar Licencia</button>
   262	            
   263	            <div id="manualResult"></div>
   264	        </div>
   265	
   266	        <div class="licenses-table">
   267	            <h2>üìã √öltimas 10 Licencias Generadas</h2>
   268	            <div id="tableContent">
   269	                <div class="loading">Cargando datos...</div>
   270	            </div>
   271	        </div>
   272	    </div>
   273	
   274	    <script>
   275	        // URL del servidor webhook (cambiar si es necesario)
   276	        const API_URL = window.location.origin;
   277	
   278	        async function loadStats() {
   279	            try {
   280	                const response = await fetch(`${API_URL}/admin/stats`);
   281	                
   282	                if (!response.ok) {
   283	                    throw new Error(`Error ${response.status}: ${response.statusText}`);
   284	                }
   285	
   286	                const data = await response.json();
   287	
   288	                // Actualizar estad√≠sticas
   289	                document.getElementById('totalLicenses').textContent = data.total_licenses || 0;
   290	                document.getElementById('emailsSent').textContent = data.emails_sent || 0;
   291	                document.getElementById('emailsFailed').textContent = data.emails_failed || 0;
   292	
   293	                // Renderizar tabla
   294	                renderTable(data.recent_licenses || []);
   295	
   296	            } catch (error) {
   297	                console.error('Error cargando estad√≠sticas:', error);
   298	                document.getElementById('tableContent').innerHTML = `
   299	                    <div class="error">
   300	                        ‚ùå Error cargando datos: ${error.message}
   301	                        <br><br>
   302	                        Verifica que el servidor webhook est√© funcionando.
   303	                    </div>
   304	                `;
   305	            }
   306	        }
   307	
   308	        function renderTable(licenses) {
   309	            if (licenses.length === 0) {
   310	                document.getElementById('tableContent').innerHTML = `
   311	                    <p style="text-align: center; color: #666; padding: 40px;">
   312	                        No hay licencias generadas todav√≠a
   313	                    </p>
   314	                `;
   315	                return;
   316	            }
   317	
   318	            const table = `
   319	                <table>
   320	                    <thead>
   321	                        <tr>
   322	                            <th>Licencia</th>
   323	                            <th>Cliente</th>
   324	                            <th>Email</th>
   325	                            <th>Order ID</th>
   326	                            <th>Fecha</th>
   327	                            <th>Estado</th>
   328	                        </tr>
   329	                    </thead>
   330	                    <tbody>
   331	                        ${licenses.map(lic => `
   332	                            <tr>
   333	                                <td><span class="license-key">${lic.license_key}</span></td>
   334	                                <td>${lic.buyer_name || '-'}</td>
   335	                                <td>${lic.buyer_email}</td>
   336	                                <td>${lic.order_id || '-'}</td>
   337	                                <td>${new Date(lic.created_at).toLocaleString('es-ES')}</td>
   338	                                <td>
   339	                                    <span class="status ${lic.email_sent ? 'sent' : 'failed'}">
   340	                                        ${lic.email_sent ? '‚úÖ Enviado' : '‚ùå Fallido'}
   341	                                    </span>
   342	                                </td>
   343	                            </tr>
   344	                        `).join('')}
   345	                    </tbody>
   346	                </table>
   347	            `;
   348	
   349	            document.getElementById('tableContent').innerHTML = table;
   350	        }
   351	
   352	        async function generateManual() {
   353	            const email = document.getElementById('manualEmail').value.trim();
   354	            const name = document.getElementById('manualName').value.trim() || 'Cliente';
   355	            const resultDiv = document.getElementById('manualResult');
   356	
   357	            if (!email) {
   358	                resultDiv.innerHTML = '<div class="error">Por favor introduce un email</div>';
   359	                return;
   360	            }
   361	
   362	            try {
   363	                resultDiv.innerHTML = '<div class="loading" style="color: #333; padding: 20px;">Generando licencia...</div>';
   364	
   365	                const response = await fetch(`${API_URL}/admin/generate`, {
   366	                    method: 'POST',
   367	                    headers: {
   368	                        'Content-Type': 'application/json'
   369	                    },
   370	                    body: JSON.stringify({ email, name })
   371	                });
   372	
   373	                const data = await response.json();
   374	
   375	                if (response.ok && data.success) {
   376	                    resultDiv.innerHTML = `
   377	                        <div class="success-message">
   378	                            ‚úÖ Licencia generada y enviada exitosamente
   379	                            <br><br>
   380	                            <strong>Licencia:</strong> <span class="license-key">${data.license_key}</span>
   381	                            <br>
   382	                            <strong>Email enviado:</strong> ${data.email_sent ? '‚úÖ S√≠' : '‚ùå No'}
   383	                        </div>
   384	                    `;
   385	
   386	                    // Limpiar formulario
   387	                    document.getElementById('manualEmail').value = '';
   388	                    document.getElementById('manualName').value = '';
   389	
   390	                    // Recargar estad√≠sticas
   391	                    setTimeout(() => loadStats(), 1000);
   392	                } else {
   393	                    throw new Error(data.error || 'Error desconocido');
   394	                }
   395	
   396	            } catch (error) {
   397	                console.error('Error generando licencia:', error);
   398	                resultDiv.innerHTML = `
   399	                    <div class="error">
   400	                        ‚ùå Error: ${error.message}
   401	                    </div>
   402	                `;
   403	            }
   404	        }
   405	
   406	        // Cargar datos al inicio
   407	        loadStats();
   408	
   409	        // Auto-refresh cada 30 segundos
   410	        setInterval(loadStats, 30000);
   411	    </script>
   412	</body>
   413	</html>
   414	
