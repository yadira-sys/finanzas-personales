<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Dinero Claro - Analizador de Finanzas Personales</title>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- SheetJS para Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/license.css">
</head>
<body>
    <!-- Notificaciones -->
    <div id="notifications" class="notifications-container"></div>

    <!-- Pantalla de Activaci√≥n de Licencia -->
    <div id="licenseScreen" class="license-screen" style="display: none;">
        <!-- El contenido se renderizar√° din√°micamente por LicenseUI -->
    </div>

    <!-- Pantalla de Perfiles (Login) -->
    <div id="profileScreen" class="profile-screen" style="display: none;">
        <div class="profile-container">
            <div class="profile-header">
                <i class="fas fa-chart-line"></i>
                <h1>Tu Dinero Claro</h1>
                <p>Selecciona o crea tu perfil</p>
            </div>

            <!-- Lista de Perfiles -->
            <div id="profileList" class="profile-list">
                <!-- Los perfiles se cargar√°n din√°micamente aqu√≠ -->
            </div>

            <!-- Bot√≥n para crear nuevo perfil -->
            <div class="profile-actions">
                <button id="createProfileBtn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Crear Nuevo Perfil
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Crear Perfil -->
    <div id="createProfileModal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Crear Nuevo Perfil</h3>
                <button class="modal-close" id="closeCreateProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="profileName">
                        <i class="fas fa-user"></i> Nombre del Perfil
                    </label>
                    <input type="text" id="profileName" class="form-input" placeholder="Ej: Juan, Mar√≠a Personal, Negocio..." maxlength="30">
                </div>
                <div class="form-group">
                    <label for="profilePin">
                        <i class="fas fa-lock"></i> PIN de Seguridad (4-8 d√≠gitos)
                    </label>
                    <input type="password" id="profilePin" class="form-input" placeholder="Ingresa tu PIN" maxlength="8" pattern="[0-9]*">
                    <small class="form-hint">Este PIN proteger√° tu perfil y datos</small>
                </div>
                <div class="form-group">
                    <label for="profilePinConfirm">
                        <i class="fas fa-lock"></i> Confirmar PIN
                    </label>
                    <input type="password" id="profilePinConfirm" class="form-input" placeholder="Repite tu PIN" maxlength="8" pattern="[0-9]*">
                </div>
                <div class="form-group">
                    <label for="profileRecoveryWord">
                        <i class="fas fa-key"></i> Palabra de Recuperaci√≥n (opcional)
                    </label>
                    <input type="text" id="profileRecoveryWord" class="form-input" placeholder="Ej: nombre de tu mascota" maxlength="50">
                    <small class="form-hint">Si olvidas tu PIN, podr√°s recuperar el acceso con esta palabra. Opcional pero recomendado.</small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelCreateProfileBtn" class="btn btn-secondary">Cancelar</button>
                <button id="confirmCreateProfileBtn" class="btn btn-primary">
                    <i class="fas fa-check"></i> Crear Perfil
                </button>
            </div>
        </div>
    </div>

    <!-- Modal: Ingresar PIN -->
    <div id="pinModal" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Ingresa tu PIN</h3>
                <button class="modal-close" id="closePinModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="pinModalProfileName" class="pin-profile-name"></p>
                <div class="form-group">
                    <input type="password" id="pinInput" class="form-input pin-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="8" pattern="[0-9]*" autofocus>
                    <small class="form-error" id="pinError" style="display: none;">PIN incorrecto</small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelPinBtn" class="btn btn-secondary">Cancelar</button>
                <button id="confirmPinBtn" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>Tu Dinero Claro</span>
                </div>
                <div class="header-actions">
                    <div id="profileInfo" class="profile-info" style="display: none;">
                        <span id="currentProfileName" class="profile-name"></span>
                        <button id="logoutBtn" class="btn btn-secondary btn-sm">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Navigation Tabs -->
    <nav class="tabs-navigation">
        <div class="container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </button>
                <button class="tab-btn" data-tab="ingresos">
                    <i class="fas fa-arrow-up"></i>
                    <span>Ingresos</span>
                </button>
                <button class="tab-btn" data-tab="gastos">
                    <i class="fas fa-arrow-down"></i>
                    <span>Gastos</span>
                </button>
                <button class="tab-btn" data-tab="balance">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Balance Mensual</span>
                </button>
                <button class="tab-btn" data-tab="reglas">
                    <i class="fas fa-cogs"></i>
                    <span>Reglas</span>
                </button>
                <button class="tab-btn" data-tab="transacciones">
                    <i class="fas fa-list"></i>
                    <span>Transacciones</span>
                </button>
                <button class="tab-btn" data-tab="ayuda" style="margin-left: auto;">
                    <i class="fas fa-question-circle"></i>
                    <span>Ayuda</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            
            <!-- TAB: Dashboard -->
            <div id="tab-dashboard" class="tab-content active">
                <!-- Upload Area -->
                <section class="upload-section">
                    <div class="section-header">
                        <h2><i class="fas fa-upload"></i> Cargar Movimientos Bancarios</h2>
                        <p>Arrastra archivos CSV o Excel de tus bancos</p>
                    </div>
                    
                    <!-- Mensaje de persistencia -->
                    <div class="info-banner">
                        <i class="fas fa-info-circle"></i>
                        <div class="info-content">
                            <strong>‚úÖ Tus datos se guardan autom√°ticamente</strong>
                            <p>Todos tus movimientos y personalizaciones permanecen guardados cuando cierras la aplicaci√≥n. Los duplicados se detectan autom√°ticamente.</p>
                        </div>
                    </div>

                    <div id="uploadArea" class="upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h3>Arrastra archivos aqu√≠</h3>
                        <p>o</p>
                        <button id="selectFileBtn" class="btn btn-primary">
                            <i class="fas fa-folder-open"></i> Seleccionar Archivos
                        </button>
                        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" multiple hidden>
                        <p class="upload-hint">Acepta CSV, Excel (.xlsx, .xls) ‚Ä¢ M√∫ltiples bancos</p>
                    </div>
                </section>

                <!-- Selector de Mes -->
                <section class="month-filter-section">
                    <div class="month-filter-card">
                        <label for="dashboardMonthFilter">
                            <i class="fas fa-calendar-alt"></i> Ver datos de:
                        </label>
                        <select id="dashboardMonthFilter" class="form-select">
                            <option value="all">Todos los meses</option>
                            <option value="current">Mes actual</option>
                            <option value="last">Mes anterior</option>
                        </select>
                    </div>
                </section>

                <!-- Summary Cards -->
                <section class="summary-section">
                    <div class="summary-cards">
                        <div class="summary-card balance">
                            <div class="card-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Balance Total</p>
                                <p class="card-value" id="totalBalance">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card income">
                            <div class="card-icon">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Ingresos Totales</p>
                                <p class="card-value" id="totalIncome">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card expense">
                            <div class="card-icon">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Gastos Totales</p>
                                <p class="card-value" id="totalExpense">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card transactions">
                            <div class="card-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Transacciones</p>
                                <p class="card-value" id="totalTransactions">0</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="charts-section">
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-bar"></i> Ingresos vs Gastos Mensuales</h3>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="monthlyChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-pie"></i> Gastos por Categor√≠a</h3>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-line"></i> Tendencia de Balance</h3>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="balanceChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-bar"></i> Top 10 Categor√≠as</h3>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="topCategoriesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB: Ingresos -->
            <div id="tab-ingresos" class="tab-content">
                <section class="income-section">
                    <div class="section-header">
                        <h2><i class="fas fa-arrow-up"></i> An√°lisis de Ingresos</h2>
                        <p>Tus fuentes de ingreso agrupadas y analizadas</p>
                    </div>

                    <!-- Income Summary -->
                    <div class="income-summary">
                        <div class="summary-card income">
                            <div class="card-icon">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Ingresos Totales</p>
                                <p class="card-value" id="incomeTotal">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-stream"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Fuentes de Ingreso</p>
                                <p class="card-value" id="incomeSources">0</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Ingreso Promedio Mensual</p>
                                <p class="card-value" id="incomeAverage">‚Ç¨0.00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Income Charts -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-pie"></i> Ingresos por Fuente</h3>
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="incomeSourcesChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-line"></i> Evoluci√≥n de Ingresos Mensuales</h3>
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="incomeEvolutionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Income by Source Table -->
                    <div class="table-card">
                        <h3><i class="fas fa-table"></i> Detalle por Fuente de Ingreso</h3>
                        <div class="table-responsive">
                            <table class="data-table" id="incomeSourcesTable">
                                <thead>
                                    <tr>
                                        <th>Fuente</th>
                                        <th>Total</th>
                                        <th>Transacciones</th>
                                        <th>Promedio</th>
                                        <th>√öltima Fecha</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-state">
                                        <td colspan="5">No hay datos de ingresos</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- All Income Transactions -->
                    <div class="table-card">
                        <h3><i class="fas fa-list"></i> Todas las Transacciones de Ingresos</h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">
                            Haz clic en cualquier categor√≠a para recategorizarla
                        </p>
                        <div class="table-responsive">
                            <table class="data-table" id="allIncomeTransactionsTable">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Descripci√≥n</th>
                                        <th>Categor√≠a</th>
                                        <th>Importe</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-state">
                                        <td colspan="5">No hay transacciones de ingresos</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB: Gastos -->
            <div id="tab-gastos" class="tab-content">
                <section class="expenses-section">
                    <div class="section-header">
                        <h2><i class="fas fa-arrow-down"></i> An√°lisis de Gastos</h2>
                        <p>Tus gastos categorizados y analizados</p>
                    </div>

                    <!-- Expenses Summary -->
                    <div class="expenses-summary">
                        <div class="summary-card expense">
                            <div class="card-icon">
                                <i class="fas fa-euro-sign"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Gastos Totales</p>
                                <p class="card-value" id="expensesTotal">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Categor√≠as Activas</p>
                                <p class="card-value" id="expensesCategories">0</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Gasto Promedio Mensual</p>
                                <p class="card-value" id="expensesAverage">‚Ç¨0.00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Expenses Charts -->
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-pie"></i> Gastos por Categor√≠a</h3>
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="expensesCategoryChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3><i class="fas fa-chart-line"></i> Evoluci√≥n de Gastos Mensuales</h3>
                            <div class="chart-container" style="height: 400px;">
                                <canvas id="expensesEvolutionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Expenses by Category Table -->
                    <div class="table-card">
                        <h3><i class="fas fa-table"></i> Detalle por Categor√≠a</h3>
                        <div class="table-responsive">
                            <table class="data-table" id="expensesCategoriesTable">
                                <thead>
                                    <tr>
                                        <th>Categor√≠a</th>
                                        <th>Total</th>
                                        <th>Transacciones</th>
                                        <th>Promedio</th>
                                        <th>% del Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-state">
                                        <td colspan="5">No hay datos de gastos</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- All Expense Transactions -->
                    <div class="table-card">
                        <h3><i class="fas fa-list"></i> Todas las Transacciones de Gastos</h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">
                            Haz clic en cualquier categor√≠a para recategorizarla
                        </p>
                        <div class="table-responsive">
                            <table class="data-table" id="allExpenseTransactionsTable">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Descripci√≥n</th>
                                        <th>Categor√≠a</th>
                                        <th>Importe</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-state">
                                        <td colspan="5">No hay transacciones de gastos</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB: Balance Mensual -->
            <div id="tab-balance" class="tab-content">
                <section class="balance-section">
                    <div class="section-header">
                        <h2><i class="fas fa-calendar-alt"></i> Balance Mensual</h2>
                        <p>An√°lisis detallado mes a mes</p>
                    </div>

                    <!-- Month Selector -->
                    <div class="month-selector-card">
                        <div class="selector-controls">
                            <button id="prevMonth" class="btn btn-secondary btn-sm">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <select id="monthSelect" class="form-select"></select>
                            <select id="yearSelect" class="form-select"></select>
                            <button id="nextMonth" class="btn btn-secondary btn-sm">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Selected Month Summary -->
                    <div id="selectedMonthSummary" class="month-summary">
                        <div class="summary-card income">
                            <div class="card-icon">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Ingresos del Mes</p>
                                <p class="card-value" id="monthIncome">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card expense">
                            <div class="card-icon">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Gastos del Mes</p>
                                <p class="card-value" id="monthExpense">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card balance">
                            <div class="card-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Balance Neto</p>
                                <p class="card-value" id="monthBalance">‚Ç¨0.00</p>
                            </div>
                        </div>
                        <div class="summary-card transactions">
                            <div class="card-icon">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Transacciones</p>
                                <p class="card-value" id="monthTransactions">0</p>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Evolution Chart -->
                    <div class="chart-card">
                        <h3><i class="fas fa-chart-line"></i> Evoluci√≥n Mensual</h3>
                        <div class="chart-container" style="height: 400px;">
                            <canvas id="monthlyEvolutionChart"></canvas>
                        </div>
                    </div>

                    <!-- All Months Summary Table -->
                    <div class="table-card">
                        <h3><i class="fas fa-table"></i> Resumen de Todos los Meses</h3>
                        <div class="table-responsive">
                            <table class="data-table" id="allMonthsTable">
                                <thead>
                                    <tr>
                                        <th>Mes</th>
                                        <th>Ingresos</th>
                                        <th>Gastos</th>
                                        <th>Balance</th>
                                        <th>Transacciones</th>
                                        <th>Ahorro %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-state">
                                        <td colspan="6">No hay datos mensuales</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB: Reglas -->
            <div id="tab-reglas" class="tab-content">
                <section class="rules-section">
                    <div class="section-header">
                        <h2><i class="fas fa-cogs"></i> Gesti√≥n de Reglas de Categorizaci√≥n</h2>
                        <p>Las reglas automatizan la categorizaci√≥n de tus transacciones futuras</p>
                    </div>

                    <!-- Info: C√≥mo crear reglas -->
                    <div class="info-banner" style="margin-bottom: 24px;">
                        <i class="fas fa-lightbulb"></i>
                        <div class="info-content">
                            <strong>üí° ¬øC√≥mo crear reglas?</strong>
                            <p>Las reglas se crean autom√°ticamente cuando <strong>categorizas manualmente una transacci√≥n</strong> en la pesta√±a "Transacciones". Simplemente haz clic en la categor√≠a de cualquier transacci√≥n, selecciona la categor√≠a correcta, y se crear√° una regla que aplicar√° autom√°ticamente esa categor√≠a a transacciones similares en el futuro.</p>
                        </div>
                    </div>

                    <!-- Rules Summary -->
                    <div class="rules-summary">
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-list"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Reglas Activas</p>
                                <p class="card-value" id="activeRulesCount">0</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">Aplicaciones Totales</p>
                                <p class="card-value" id="rulesApplications">0</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="card-content">
                                <p class="card-label">√öltima Actualizaci√≥n</p>
                                <p class="card-value" id="lastRuleUpdate">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- Rules Actions -->
                    <div class="rules-actions">
                        <button id="applyRulesBtn" class="btn btn-primary">
                            <i class="fas fa-play"></i> Aplicar Reglas a Todas las Transacciones
                        </button>
                        <button id="clearRulesBtn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Borrar Todas las Reglas
                        </button>
                    </div>

                    <!-- Rules Table -->
                    <div class="table-card">
                        <h3><i class="fas fa-table"></i> Reglas Configuradas</h3>
                        <div class="table-responsive">
                            <table class="data-table" id="rulesTable">
                                <thead>
                                    <tr>
                                        <th>Patr√≥n de B√∫squeda</th>
                                        <th>Categor√≠a</th>
                                        <th>Creada</th>
                                        <th>Aplicaciones</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-state">
                                        <td colspan="5">
                                            No hay reglas configuradas. 
                                            <br>
                                            <small>Las reglas se crean autom√°ticamente cuando categorizas transacciones en la pesta√±a de Transacciones.</small>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Rules Info -->
                    <div class="info-card">
                        <h4><i class="fas fa-info-circle"></i> C√≥mo funcionan las reglas</h4>
                        <ul>
                            <li><strong>Creaci√≥n autom√°tica:</strong> Cuando categorizas manualmente una transacci√≥n en la pesta√±a "Transacciones", se crea autom√°ticamente una regla para esa descripci√≥n.</li>
                            <li><strong>Aplicaci√≥n autom√°tica:</strong> Las reglas se aplican autom√°ticamente cuando cargas nuevos archivos bancarios.</li>
                            <li><strong>Patrones inteligentes:</strong> Las reglas buscan coincidencias en las descripciones de las transacciones.</li>
                            <li><strong>Gesti√≥n flexible:</strong> Puedes ver, editar o eliminar reglas individuales desde esta pantalla.</li>
                            <li><strong>Reaplicaci√≥n:</strong> Usa el bot√≥n "Aplicar Reglas" para recategorizar todas tus transacciones existentes.</li>
                        </ul>
                    </div>
                </section>
            </div>

            <!-- TAB: Transacciones -->
            <div id="tab-transacciones" class="tab-content">
                <section class="transactions-section">
                    <div class="section-header">
                        <h2><i class="fas fa-list"></i> Todas las Transacciones</h2>
                        <p>Gestiona y categoriza tus transacciones</p>
                    </div>

                    <!-- Info: Crear reglas -->
                    <div class="info-banner" style="margin-bottom: 24px; background: linear-gradient(135deg, #fef3c7 0%, #fef9e7 100%); border-left-color: #f59e0b;">
                        <i class="fas fa-magic" style="color: #f59e0b;"></i>
                        <div class="info-content">
                            <strong>‚ú® Crea reglas autom√°ticamente</strong>
                            <p><strong>Haz clic en cualquier categor√≠a</strong> de la tabla para cambiarla. Se crear√° autom√°ticamente una regla que aplicar√° esa categor√≠a a transacciones similares en el futuro.</p>
                        </div>
                    </div>

                    <!-- Filters and Search -->
                    <div class="filters-card">
                        <div class="filters-row">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchInput" placeholder="Buscar por descripci√≥n, importe...">
                            </div>
                            <select id="categoryFilter" class="form-select">
                                <option value="">Todas las categor√≠as</option>
                            </select>
                            <select id="typeFilter" class="form-select">
                                <option value="">Todos los tipos</option>
                                <option value="income">Ingresos</option>
                                <option value="expense">Gastos</option>
                            </select>
                            <button id="exportBtn" class="btn btn-secondary">
                                <i class="fas fa-download"></i>
                                <span class="btn-text">Exportar CSV</span>
                            </button>
                        </div>
                        <div class="filter-info">
                            <span id="filterInfo">Mostrando 0 transacciones</span>
                        </div>
                    </div>

                    <!-- Transactions Table -->
                    <div class="table-card">
                        <div class="table-responsive">
                            <table class="data-table" id="transactionsTable">
                                <thead>
                                    <tr>
                                        <th data-sort="date">
                                            Fecha 
                                            <i class="fas fa-sort"></i>
                                        </th>
                                        <th data-sort="description">
                                            Descripci√≥n 
                                            <i class="fas fa-sort"></i>
                                        </th>
                                        <th data-sort="category">
                                            Categor√≠a 
                                            <i class="fas fa-sort"></i>
                                        </th>
                                        <th data-sort="amount">
                                            Importe 
                                            <i class="fas fa-sort"></i>
                                        </th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-state">
                                        <td colspan="5">
                                            No hay transacciones. Carga archivos en la pesta√±a Dashboard.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Inline Category Editor (Hidden by default) -->
                    <div id="categoryEditor" class="category-editor" style="display: none;">
                        <div class="editor-content">
                            <h4>Categorizar Transacci√≥n</h4>
                            <p class="editor-description" id="editorDescription"></p>
                            <div class="editor-categories" id="editorCategories"></div>
                            <div class="editor-actions">
                                <button id="cancelEditBtn" class="btn btn-secondary btn-sm">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TAB: Ayuda -->
            <div id="tab-ayuda" class="tab-content">
                <section class="help-section">
                    <div class="section-header">
                        <h2><i class="fas fa-question-circle"></i> Centro de Ayuda</h2>
                        <p>Gu√≠a completa para usar Tu Dinero Claro</p>
                    </div>

                    <div class="help-grid">
                        <!-- Primeros Pasos -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-play-circle"></i>
                            </div>
                            <h3>üöÄ Primeros Pasos</h3>
                            <ol>
                                <li><strong>Crea tu perfil</strong>: Al abrir la app, crea un perfil con nombre y PIN (4-8 d√≠gitos)</li>
                                <li><strong>Carga tus datos</strong>: Arrastra o selecciona archivos CSV/Excel de tu banco</li>
                                <li><strong>Revisa el Dashboard</strong>: Ver√°s autom√°ticamente tus ingresos, gastos y balance</li>
                            </ol>
                        </div>

                        <!-- Importar Datos -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-file-import"></i>
                            </div>
                            <h3>üì• Importar Movimientos</h3>
                            <p><strong>Formatos aceptados:</strong> CSV, Excel (.xlsx, .xls)</p>
                            <p><strong>Bancos compatibles:</strong> BBVA, Santander, CaixaBank, ING, Bankinter y m√°s</p>
                            <p><strong>¬øC√≥mo obtener el archivo?</strong></p>
                            <ol>
                                <li>Entra a tu banca online</li>
                                <li>Ve a "Movimientos" o "Extractos"</li>
                                <li>Busca la opci√≥n "Exportar" o "Descargar"</li>
                                <li>Selecciona formato CSV o Excel</li>
                                <li>Elige el rango de fechas</li>
                                <li>Descarga y carga aqu√≠</li>
                            </ol>
                            <div class="help-note">
                                <i class="fas fa-shield-check"></i>
                                <strong>Detecci√≥n de Duplicados:</strong> Puedes subir el mismo archivo m√∫ltiples veces sin preocuparte. La app detecta autom√°ticamente duplicados y solo agrega transacciones nuevas.
                            </div>
                        </div>

                        <!-- Crear Reglas -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-magic"></i>
                            </div>
                            <h3>‚ú® Crear Reglas Autom√°ticas</h3>
                            <p><strong>¬øC√≥mo funcionan?</strong> Las reglas categorizan autom√°ticamente transacciones similares.</p>
                            <p><strong>¬øC√≥mo crear una regla?</strong></p>
                            <ol>
                                <li>Ve a la pesta√±a <strong>"Transacciones"</strong></li>
                                <li>Haz clic en la <strong>categor√≠a</strong> de cualquier transacci√≥n</li>
                                <li>Selecciona la categor√≠a correcta</li>
                                <li>¬°Listo! Se crea autom√°ticamente una regla</li>
                            </ol>
                            <p><strong>Gestionar reglas:</strong> En la pesta√±a "Reglas" puedes ver todas tus reglas, aplicarlas a todas las transacciones, o eliminarlas.</p>
                        </div>

                        <!-- Perfiles -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3>üë• Sistema de Perfiles</h3>
                            <p><strong>¬øPara qu√© sirven?</strong> Permite que m√∫ltiples personas usen la app con total privacidad.</p>
                            <p><strong>Crear perfil:</strong> Click en "Crear Nuevo Perfil" al iniciar la app.</p>
                            <p><strong>Cambiar de perfil:</strong> Click en "Cerrar Sesi√≥n" ‚Üí Selecciona otro perfil ‚Üí Ingresa PIN.</p>
                            <p><strong>Datos separados:</strong> Cada perfil tiene sus propias transacciones y reglas.</p>
                            <div class="help-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>PIN Olvidado:</strong> No hay recuperaci√≥n de PIN actualmente. Guarda tu PIN en un lugar seguro. Planificado para v1.1.
                            </div>
                        </div>

                        <!-- Guardado de Datos -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-save"></i>
                            </div>
                            <h3>üíæ ¬øSe guardan mis datos?</h3>
                            <p><strong>‚úÖ S√ç.</strong> Todos tus datos se guardan autom√°ticamente en tu navegador.</p>
                            <p><strong>¬øQu√© se guarda?</strong></p>
                            <ul>
                                <li>Todas tus transacciones</li>
                                <li>Tus reglas de categorizaci√≥n</li>
                                <li>Tus perfiles y PINs</li>
                            </ul>
                            <p><strong>¬øCu√°ndo se guarda?</strong> Autom√°ticamente despu√©s de cada acci√≥n.</p>
                            <p><strong>¬øD√≥nde se guarda?</strong> Localmente en tu navegador (localStorage).</p>
                            <div class="help-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>Importante:</strong> Si borras las cookies/cach√© del navegador, perder√°s todos los datos. Exporta regularmente tus transacciones como backup.
                            </div>
                        </div>

                        <!-- Privacidad -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>üîí Privacidad y Seguridad</h3>
                            <p><strong>100% Local:</strong> Todos tus datos se procesan en tu navegador. Nada se env√≠a a servidores externos.</p>
                            <p><strong>Tu privacidad garantizada:</strong></p>
                            <ul>
                                <li>‚ùå No hay servidores</li>
                                <li>‚ùå No hay bases de datos externas</li>
                                <li>‚ùå No compartimos informaci√≥n</li>
                                <li>‚ùå No hay tracking</li>
                                <li>‚úÖ Procesamiento 100% local</li>
                                <li>‚úÖ T√∫ controlas tus datos</li>
                            </ul>
                        </div>

                        <!-- Filtros y B√∫squeda -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-filter"></i>
                            </div>
                            <h3>üîç Filtros y Selector de Mes</h3>
                            <p><strong>Dashboard:</strong> Usa el selector de mes para ver datos de un mes espec√≠fico, mes actual, mes anterior, o todos los meses.</p>
                            <p><strong>Transacciones:</strong> Busca por descripci√≥n, filtra por categor√≠a o tipo (ingresos/gastos).</p>
                            <p><strong>Ordenar:</strong> Haz clic en cualquier columna para ordenar la tabla.</p>
                        </div>

                        <!-- Exportar -->
                        <div class="help-card">
                            <div class="help-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <h3>üì§ Exportar Datos</h3>
                            <p><strong>Ubicaci√≥n:</strong> Pesta√±a "Transacciones" ‚Üí Bot√≥n "Exportar CSV"</p>
                            <p><strong>Uso:</strong> Crea un backup de tus datos o √∫salos en otras aplicaciones (Excel, Google Sheets).</p>
                            <p><strong>Recomendaci√≥n:</strong> Exporta tus datos mensualmente como backup de seguridad.</p>
                        </div>

                        <!-- Preguntas Frecuentes -->
                        <div class="help-card help-card-full">
                            <div class="help-icon">
                                <i class="fas fa-question"></i>
                            </div>
                            <h3>‚ùì Preguntas Frecuentes</h3>
                            
                            <div class="faq-item">
                                <strong>¬øPuedo usar la app en varios dispositivos?</strong>
                                <p>Los datos se guardan localmente en cada dispositivo. Para usar en m√∫ltiples dispositivos, exporta el CSV en uno e imp√≥rtalo en el otro.</p>
                            </div>
                            
                            <div class="faq-item">
                                <strong>¬øQu√© pasa si subo el mismo archivo dos veces?</strong>
                                <p>No te preocupes. El sistema detecta duplicados autom√°ticamente y solo agrega transacciones nuevas.</p>
                            </div>
                            
                            <div class="faq-item">
                                <strong>¬øPuedo cambiar la categor√≠a de muchas transacciones a la vez?</strong>
                                <p>S√≠. Cambia manualmente una transacci√≥n, se crear√° una regla. Luego ve a "Reglas" y haz clic en "Aplicar Reglas a Todas las Transacciones".</p>
                            </div>
                            
                            <div class="faq-item">
                                <strong>Mi archivo no se carga, ¬øqu√© hago?</strong>
                                <p>Verifica que el archivo tenga columnas de Fecha, Descripci√≥n e Importe. La app detecta autom√°ticamente la mayor√≠a de formatos bancarios espa√±oles.</p>
                            </div>

                            <div class="faq-item">
                                <strong>¬øCu√°ntos perfiles puedo crear?</strong>
                                <p>Por razones de licenciamiento, hay un l√≠mite de perfiles por instalaci√≥n. Esto previene el uso compartido no autorizado.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>
                <i class="fas fa-shield-alt"></i> 
                Tus datos se procesan localmente en tu navegador. 
                No se env√≠a nada a servidores externos.
            </p>
            <div class="footer-danger-zone">
                <button id="clearDataBtn" class="btn-danger-small" title="Borrar todos los datos">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="./js/license.js"></script>
    <script src="./js/license-ui.js"></script>
    <script src="./js/categories.js"></script>
    <script src="./js/parser.js"></script>
    <script src="./js/charts.js"></script>
    <script src="./js/rules.js"></script>
    <script src="./js/profiles.js"></script>
    <script src="./js/profiles-ui.js"></script>
    <script src="./js/app.js"></script>
</body>
</html>
